"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(n,!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _iterableToArrayLimit(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var defaultParameters={observer:{},infinite:!1},Animator=function(){function s(t,e){_classCallCheck(this,s),this.el=t,this.options=e,this.iteration=0,this.duration=1e3,this.state={enter:!1,animating:!1,unobserved:!1,triggerPoint:0}}return _createClass(s,[{key:"getAnimationOptions",value:function(){this.animationDuration=+this.el.getAttribute("data-anim-duration")||this.duration,this.animationDelay=+this.el.getAttribute("data-anim-delay")||0,this.animationIterations=+this.el.getAttribute("data-anim-iterations")||1,this.animationTimingFunction=this.el.getAttribute("data-anim-ease")||"ease"}},{key:"showElement",value:function(){this.el.style.visibility="visible",this.el.classList.add(this.animationName),this.el.style.animationDuration="".concat(this.animationDuration,"ms"),"ease"!==this.animationTimingFunction&&(this.el.style.animationTimingFunction=this.animationTimingFunction)}},{key:"hideElement",value:function(){this.el.style.visibility="hidden",this.el.classList.remove(this.animationName),this.el.style.animationDuration="",this.el.style.animationTimingFunction=""}}],[{key:"animateEls",value:function(r,a){var o=this;r.forEach(function(t){var e,n=t.target;if(o.animators.length<r.length)e=new s(n,o.options),o.animators.push(e);else{var i=_slicedToArray(o.animators.filter(function(t){return t.el===n}),1);e=i[0]}e.animationName=n.getAttribute("data-anim-name"),e.animationName&&(e.getAnimationOptions(),e.state.enter||e.hideElement(),e.state.triggerPoint=3===o.observer.thresholds.length?o.observer.thresholds[1]:o.observer.thresholds[0],t.isIntersecting&&!e.state.animating&&!e.state.enter&&t.intersectionRatio>=e.state.triggerPoint?(e.state.enter=!0,e.state.animating=!0,e.iteration+=1,e.duration=e.animationDuration+e.animationDelay,e.delay=e.animationDelay,setTimeout(function(){e.showElement()},e.delay),setTimeout(function(){e.state.animating=!1,e.iteration>=e.animationIterations&&!e.options.infinite&&(a.unobserve(e.el),e.showElement(),e.state.unobserved=!0,o.onComplete&&o.onComplete(e))},e.duration),o.onEnter&&o.onEnter(e)):(0<e.animationIterations&&!e.state.animating||e.options.infinite&&!e.state.animating||!e.state.animating&&!e.state.enter)&&t.intersectionRatio<=0&&(e.state.enter=!1,e.hideElement()))})}}]),s}(),Anim=function(){function n(t,e){_classCallCheck(this,n),this.els=_toConsumableArray(t),this.options=_objectSpread2({},defaultParameters,{},e),this.animate=Animator.animateEls,this.animators=[]}return _createClass(n,[{key:"observe",value:function(){var e=this;this.els.length&&(this.observer=new IntersectionObserver(this.animate.bind(this),this.options.observer),this.els.forEach(function(t){e.observer.observe(t)}))}},{key:"unobserve",value:function(){var n=this;this.els.forEach(function(t,e){n.observer.unobserve(t),0<n.animators.length&&n.animators[e].showElement()}),this.animators=[]}}]),n}();module.exports=Anim;
